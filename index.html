<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Turkey Trip Itinerary & Budget</title>
<style>
  /* --- General Styles --- */
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    line-height: 1.6;
    color: #333;
    background-color: #f4f4f4;
    margin: 0;
    padding: 10px 10px 40px 10px;
  }
  .container {
    max-width: 800px;
    margin: 0 auto 20px auto;
    background: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  h1 { color: #333; }
  h2 { color: #558b2f; } /* Dark Green for Headers */

  /* --- Itinerary Accordion Styles (Blue) --- */
  .itinerary-header {
    cursor: pointer;
    padding: 10px 15px;
    background-color: #007bff;
    color: white;
    font-weight: bold;
    border-radius: 5px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .day-content {
    display: none;
    padding: 0 10px;
  }
  .itinerary-header .arrow {
    border: solid white;
    border-width: 0 3px 3px 0;
    display: inline-block;
    padding: 3px;
    transform: rotate(45deg);
    transition: transform 0.3s;
  }
  .itinerary-header.active .arrow { transform: rotate(-135deg); }

  /* --- Budget Accordion Styles (Green) --- */
   .budget-header {
    cursor: pointer;
    padding: 10px 15px;
    background-color: #84cc16; /* Lime Green */
    color: white;
    font-weight: bold;
    border-radius: 5px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .budget-header .arrow {
    border: solid white;
    border-width: 0 3px 3px 0;
    display: inline-block;
    padding: 3px;
    transform: rotate(45deg);
    transition: transform 0.3s;
  }
  .budget-header.active .arrow { transform: rotate(-135deg); }

  /* --- Budget Table Styles --- */
  .budget-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }
  .budget-table th, .budget-table td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
  }
  .budget-table th {
    background-color: #f0fdf4; /* Very Light Green */
    font-weight: bold;
  }
  .budget-table input[type="text"] {
    width: 95%;
    padding: 5px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px;
  }
  .budget-table input[type="number"] {
    width: 85%;
    padding: 5px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px;
  }
  .budget-table input::-webkit-outer-spin-button,
  .budget-table input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  .budget-table input[type="number"] { -moz-appearance: textfield; }
  
  .add-expense-btn, .clear-data-btn {
    display: inline-block;
    margin: 10px 10px 5px 0;
    padding: 8px 12px;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
  .add-expense-btn { background-color: #4d7c0f; /* Darker Green */ }
  .clear-data-btn { background-color: #dc2626; /* Red */}

  .total-row {
    font-weight: bold;
    background-color: #f7fee7; /* Light Green */
  }
  .grand-total {
    margin-top: 20px;
    padding: 15px;
    background-color: #65a30d; /* Darker Main Green */
    color: white;
    border-radius: 8px;
    font-size: 1.1em;
  }
  .grand-total div { margin-bottom: 5px; }
  .grand-total div:last-child { margin-bottom: 0; }
</style>
</head>
<body>

<div class="container">
  <h1>My Turkey Itinerary</h1>
  <div class="day">
    <div class="itinerary-header">Day 1: 10/23 Thu - Arrival in Istanbul <span class="arrow"></span></div>
    <div class="day-content">
      <p><strong>Flights:</strong> 00:30 TPE(T2) - 05:15 DXB(T3) / 10:40 DXB(T3) - 14:25 IST</p>
      <p><strong>Accommodation:</strong> Chambers of the Boheme</p>
    </div>
  </div>
  <div class="day">
    <div class="itinerary-header">Day 2: 10/24 Fri - Istanbul: Old & Asian Districts <span class="arrow"></span></div>
    <div class="day-content"><p>ePass Day: Topkapi Palace, Grand Bazaar, Spice Bazaar, Bosphorus Cruise</p></div>
  </div>
  <div class="day">
    <div class="itinerary-header">Day 3: 10/25 Sat - Istanbul: Old City Highlights <span class="arrow"></span></div>
    <div class="day-content"><p>ePass Day: Blue Mosque, Basilica Cistern, Hagia Sophia, Whirling Dervishes</p></div>
  </div>
  <div class="day">
    <div class="itinerary-header">Day 4: 10/26 Sun - Istanbul to Cappadocia <span class="arrow"></span></div>
    <div class="day-content"><p>Dolmabahçe Palace, Taksim, Galata Tower. Flight to Cappadocia.</p></div>
  </div>
  <div class="day">
    <div class="itinerary-header">Day 5: 10/27 Mon - Cappadocia <span class="arrow"></span></div>
    <div class="day-content"><p>Hot Air Balloon, Green Line Tour.</p></div>
  </div>
  <div class="day">
    <div class="itinerary-header">Day 6: 10/28 Tue - Cappadocia <span class="arrow"></span></div>
    <div class="day-content"><p>Göreme Open Air Museum, Sunset Horse Riding.</p></div>
  </div>
  <div class="day">
    <div class="itinerary-header">Day 7: 10/29 Wed - Cappadocia to Pamukkale <span class="arrow"></span></div>
    <div class="day-content"><p>Red Line Tour, Night Bus to Pamukkale.</p></div>
  </div>
  <div class="day">
    <div class="itinerary-header">Day 8: 10/30 Thu - Pamukkale & Izmir <span class="arrow"></span></div>
    <div class="day-content"><p>Explore Pamukkale, Train to Izmir.</p></div>
  </div>
  <div class="day">
    <div class="itinerary-header">Day 9: 10/31 Fri - Izmir <span class="arrow"></span></div>
    <div class="day-content"><p>Ephesus Archaeological Site Day Tour.</p></div>
  </div>
  <div class="day">
    <div class="itinerary-header">Day 10: 11/1 Sat - Izmir to Istanbul <span class="arrow"></span></div>
    <div class="day-content"><p>Explore Izmir, fly to Istanbul.</p></div>
  </div>
  <div class="day">
    <div class="itinerary-header">Day 11: 11/2 Sun - Last Day in Istanbul <span class="arrow"></span></div>
    <div class="day-content"><p>Flea Market, Spice Market, Last minute exploring.</p></div>
  </div>
  <div class="day">
    <div class="itinerary-header">Day 12: 11/3 Mon - Journey Home <span class="arrow"></span></div>
    <div class="day-content"><p>Flights home.</p></div>
  </div>
</div>

<div class="container">
  <h2>Trip Budget & Expenses</h2>

  <div class="day" id="pre-trip-section">
    <div class="budget-header active">Pre-Trip & Fixed Costs <span class="arrow"></span></div>
    <div class="day-content" style="display: block;">
      <table class="budget-table">
        <thead><tr><th>Item</th><th>TRY (₺)</th><th>TWD (NT$)</th><th>EUR (€)</th></tr></thead>
        <tbody></tbody>
        <tfoot><tr class="total-row"><td>Subtotal</td><td id="pre-trip-try-total">0.00</td><td id="pre-trip-twd-total">0.00</td><td id="pre-trip-eur-total">0.00</td></tr></tfoot>
      </table>
      <button class="add-expense-btn">Add Expense</button>
    </div>
  </div>

  <div id="daily-budget-sections">
    </div>

  <div class="grand-total">
    <h3>Trip Grand Total</h3>
    <div id="grand-total-try">Total TRY (₺): 0.00</div>
    <div id="grand-total-twd">Total TWD (NT$): 0.00</div>
    <div id="grand-total-eur">Total EUR (€): 0.00</div>
  </div>
   <button class="clear-data-btn">Clear All Budget Data</button>

</div>


<script>
// --- GLOBAL DATA & CONSTANTS ---
const STORAGE_KEY = 'turkeyBudgetData';
const cityMap = { 1: "Istanbul", 2: "Istanbul", 3: "Istanbul", 4: "Istanbul/Cappadocia", 5: "Cappadocia", 6: "Cappadocia", 7: "Cappadocia/Bus", 8: "Pamukkale/Izmir", 9: "Izmir", 10: "Izmir/Istanbul", 11: "Istanbul" };
const sectionIds = ['pre-trip', ...Array.from({length: 11}, (_, i) => `day${i + 1}`)];


// --- DATA PERSISTENCE FUNCTIONS ---

// Function to SAVE all data from the tables to localStorage
function saveData() {
    const allData = {};
    sectionIds.forEach(id => {
        const sectionRows = [];
        const rows = document.querySelectorAll(`#${id}-section tbody tr`);
        rows.forEach(row => {
            sectionRows.push({
                item: row.querySelector('.item-input').value,
                try: row.querySelector('.try-input').value,
                twd: row.querySelector('.twd-input').value,
                eur: row.querySelector('.eur-input').value
            });
        });
        allData[id] = sectionRows;
    });
    localStorage.setItem(STORAGE_KEY, JSON.stringify(allData));
}

// Function to LOAD all data from localStorage and build the tables
function loadData() {
    const savedDataJSON = localStorage.getItem(STORAGE_KEY);
    const data = savedDataJSON ? JSON.parse(savedDataJSON) : {};

    // Load Pre-trip data or create a default row
    const preTripTbody = document.querySelector('#pre-trip-section tbody');
    preTripTbody.innerHTML = ''; // Clear existing
    const preTripData = data['pre-trip'] || [{ item: 'Flights (TPE-IST)', try: '', twd: '', eur: '' }];
    preTripData.forEach(rowData => addExpenseRow(preTripTbody, rowData));

    // Create and Load Daily sections
    const dailyContainer = document.getElementById('daily-budget-sections');
    dailyContainer.innerHTML = ''; // Clear for reload
    for (let i = 1; i <= 11; i++) {
        const dayId = `day${i}`;
        const daySectionHTML = `
            <div class="day" id="${dayId}-section">
                <div class="budget-header">Day ${i}: ${cityMap[i]} Expenses <span class="arrow"></span></div>
                <div class="day-content">
                    <table class="budget-table">
                        <thead><tr><th>Item</th><th>TRY (₺)</th><th>TWD (NT$)</th><th>EUR (€)</th></tr></thead>
                        <tbody></tbody>
                        <tfoot><tr class="total-row"><td>Daily Total</td><td id="${dayId}-try-total">0.00</td><td id="${dayId}-twd-total">0.00</td><td id="${dayId}-eur-total">0.00</td></tr></tfoot>
                    </table>
                    <button class="add-expense-btn">Add Expense</button>
                </div>
            </div>`;
        dailyContainer.innerHTML += daySectionHTML;
        
        const dayTbody = document.querySelector(`#${dayId}-section tbody`);
        const dayData = data[dayId] || [{ item: '', try: '', twd: '', eur: '' }];
        dayData.forEach(rowData => addExpenseRow(dayTbody, rowData));
    }
}


// --- CORE FUNCTIONS ---
function calculateAllTotals() {
    let grandTotal = { try: 0, twd: 0, eur: 0 };

    sectionIds.forEach(id => {
        const sectionTotal = calculateSectionTotal(`#${id}-section`);
        if(id === 'pre-trip') {
            document.getElementById('pre-trip-try-total').textContent = sectionTotal.try.toFixed(2);
            document.getElementById('pre-trip-twd-total').textContent = sectionTotal.twd.toFixed(2);
            document.getElementById('pre-trip-eur-total').textContent = sectionTotal.eur.toFixed(2);
        } else {
            document.getElementById(`${id}-try-total`).textContent = sectionTotal.try.toFixed(2);
            document.getElementById(`${id}-twd-total`).textContent = sectionTotal.twd.toFixed(2);
            document.getElementById(`${id}-eur-total`).textContent = sectionTotal.eur.toFixed(2);
        }
        grandTotal.try += sectionTotal.try;
        grandTotal.twd += sectionTotal.twd;
        grandTotal.eur += sectionTotal.eur;
    });

    document.getElementById('grand-total-try').textContent = `Total TRY (₺): ${grandTotal.try.toFixed(2)}`;
    document.getElementById('grand-total-twd').textContent = `Total TWD (NT$): ${grandTotal.twd.toFixed(2)}`;
    document.getElementById('grand-total-eur').textContent = `Total EUR (€): ${grandTotal.eur.toFixed(2)}`;
    
    // This is the new, crucial line: Save data on every calculation.
    saveData();
}

function calculateSectionTotal(sectionSelector) {
    const section = document.querySelector(sectionSelector);
    let total = { try: 0, twd: 0, eur: 0 };
    if (!section) return total;
    section.querySelectorAll('.try-input').forEach(input => total.try += parseFloat(input.value) || 0);
    section.querySelectorAll('.twd-input').forEach(input => total.twd += parseFloat(input.value) || 0);
    section.querySelectorAll('.eur-input').forEach(input => total.eur += parseFloat(input.value) || 0);
    return total;
}

function addExpenseRow(tableBody, data = { item: '', try: '', twd: '', eur: '' }) {
    const newRow = document.createElement('tr');
    newRow.innerHTML = `
        <td><input type="text" class="item-input" placeholder="New item" value="${data.item}"></td>
        <td><input type="number" class="try-input" placeholder="0" value="${data.try}"></td>
        <td><input type="number" class="twd-input" placeholder="0" value="${data.twd}"></td>
        <td><input type="number" class="eur-input" placeholder="0" value="${data.eur}"></td>
    `;
    tableBody.appendChild(newRow);
}

// --- EVENT LISTENERS & INITIALIZATION ---
function setupEventListeners() {
    // Accordion functionality for all headers
    document.querySelectorAll('.itinerary-header, .budget-header').forEach(header => {
      header.addEventListener('click', () => {
        header.classList.toggle('active');
        const content = header.nextElementSibling;
        content.style.display = content.style.display === "block" ? "none" : "block";
      });
    });

    // Use event delegation for dynamically added buttons and inputs
    document.querySelector('.container:last-of-type').addEventListener('click', (event) => {
        if (event.target.classList.contains('add-expense-btn')) {
            const tableBody = event.target.previousElementSibling.querySelector('tbody');
            addExpenseRow(tableBody);
            // Re-attach listeners to new inputs
            setupInputListeners();
        }
        if (event.target.classList.contains('clear-data-btn')) {
            if (confirm('Are you sure you want to delete all budget data? This cannot be undone.')) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }
    });
    
    setupInputListeners();
}

function setupInputListeners(){
     document.querySelectorAll('.budget-table input').forEach(input => {
        input.addEventListener('input', calculateAllTotals);
    });
}

// --- Main execution on page load ---
document.addEventListener('DOMContentLoaded', () => {
    loadData();
    setupEventListeners();
    calculateAllTotals();
});

</script>

</body>
</html>
